<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.vcooline.crm.common.mapper.CrmClueMapper">
  <resultMap id="BaseResultMap" type="com.vcooline.crm.common.model.CrmClue">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 22 10:16:27 CST 2015.
    -->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="clue_id" jdbcType="BIGINT" property="clueId" />
    <result column="clue_number" jdbcType="VARCHAR" property="clueNumber" />
    <result column="num_code" jdbcType="INTEGER" property="numCode" />
    <result column="clue_source" jdbcType="TINYINT" property="clueSource" />
    <result column="clue_know" jdbcType="TINYINT" property="clueKnow" />
    <result column="clue_consult" jdbcType="TINYINT" property="clueConsult" />
    <result column="clue_type" jdbcType="TINYINT" property="clueType" />
    <result column="clue_status_online" jdbcType="TINYINT" property="clueStatusOnline" />
    <result column="clue_keyword" jdbcType="VARCHAR" property="clueKeyword" />
    <result column="admin_id" jdbcType="BIGINT" property="adminId" />
    <result column="admin_name" jdbcType="VARCHAR" property="adminName" />
    <result column="owner" jdbcType="BIGINT" property="owner" />
    <result column="owner_name" jdbcType="VARCHAR" property="ownerName" />
    <result column="cust_name" jdbcType="VARCHAR" property="custName" />
    <result column="cust_addr" jdbcType="VARCHAR" property="custAddr" />
    <result column="cust_province" jdbcType="INTEGER" property="custProvince" />
    <result column="cust_city" jdbcType="INTEGER" property="custCity" />
    <result column="cust_area" jdbcType="INTEGER" property="custArea" />
    <result column="is_callback" jdbcType="BIT" property="isCallback" />
    <result column="remark" jdbcType="VARCHAR" property="remark" />
    <result column="return_change_remark" jdbcType="VARCHAR" property="returnChangeRemark" />
    <result column="is_del" jdbcType="BIT" property="isDel" />
    <result column="allot_time" jdbcType="TIMESTAMP" property="allotTime" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="create_time_long" jdbcType="BIGINT" property="createTimeLong" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="owner_type" jdbcType="TINYINT" property="ownerType" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 22 10:16:27 CST 2015.
    -->
    id,clue_id, clue_number, num_code, clue_source, clue_know, clue_consult, clue_type, clue_status_online,
    clue_keyword, admin_id, admin_name, owner, owner_name, cust_name, cust_addr, cust_province, 
    cust_city, cust_area, is_callback, remark,return_change_remark, is_del, allot_time, create_time,create_time_long, update_time,owner_type
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 22 10:16:27 CST 2015.
    -->
    select 
    <include refid="Base_Column_List" />
    from crm_clue
    where id = #{id,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 22 10:16:27 CST 2015.
    -->
    delete from crm_clue
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.vcooline.crm.common.model.CrmClue" useGeneratedKeys="true" keyProperty="id">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 22 10:16:27 CST 2015.
    -->
    insert into crm_clue (id,clue_id, clue_number, num_code,
      clue_source, clue_know, clue_consult, 
      clue_type, clue_status_online, clue_keyword, 
      admin_id, admin_name, owner, 
      owner_name, cust_name, cust_addr, 
      cust_province, cust_city, cust_area, 
      is_callback, remark,return_change_remark, is_del, 
      allot_time, create_time, create_time_long,update_time,owner_type
      )
    values (#{id,jdbcType=BIGINT},#{clueId,jdbcType=BIGINT}, #{clueNumber,jdbcType=VARCHAR}, #{numCode,jdbcType=TINYINT},
      #{clueSource,jdbcType=TINYINT}, #{clueKnow,jdbcType=TINYINT}, #{clueConsult,jdbcType=TINYINT}, 
      #{clueType,jdbcType=TINYINT}, #{clueStatusOnline,jdbcType=TINYINT}, #{clueKeyword,jdbcType=VARCHAR}, 
      #{adminId,jdbcType=BIGINT}, #{adminName,jdbcType=VARCHAR}, #{owner,jdbcType=BIGINT}, 
      #{ownerName,jdbcType=VARCHAR}, #{custName,jdbcType=VARCHAR}, #{custAddr,jdbcType=VARCHAR}, 
      #{custProvince,jdbcType=INTEGER}, #{custCity,jdbcType=INTEGER}, #{custArea,jdbcType=INTEGER}, 
      #{isCallback,jdbcType=BIT}, #{remark,jdbcType=VARCHAR},#{returnChangeRemark,jdbcType=VARCHAR}, #{isDel,jdbcType=BIT}, 
      #{allotTime,jdbcType=TIMESTAMP}, #{createTime,jdbcType=TIMESTAMP}, #{createTimeLong,jdbcType=BIGINT},#{updateTime,jdbcType=TIMESTAMP},#{ownerType,jdbcType=TINYINT}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.vcooline.crm.common.model.CrmClue" useGeneratedKeys="true" keyProperty="id">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 22 10:16:27 CST 2015.
    -->
    insert into crm_clue
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="clueId != null">
            clue_id,
      </if>
      <if test="clueNumber != null">
        clue_number,
      </if>
      <if test="numCode != null">
        num_code,
      </if>
      <if test="clueSource != null">
        clue_source,
      </if>
      <if test="clueKnow != null">
        clue_know,
      </if>
      <if test="clueConsult != null">
        clue_consult,
      </if>
      <if test="clueType != null">
        clue_type,
      </if>
      <if test="clueStatusOnline != null">
        clue_status_online,
      </if>
      <if test="clueKeyword != null">
        clue_keyword,
      </if>
      <if test="adminId != null">
        admin_id,
      </if>
      <if test="adminName != null">
        admin_name,
      </if>
      <if test="owner != null">
        owner,
      </if>
      <if test="ownerName != null">
        owner_name,
      </if>
      <if test="custName != null">
        cust_name,
      </if>
      <if test="custAddr != null">
        cust_addr,
      </if>
      <if test="custProvince != null">
        cust_province,
      </if>
      <if test="custCity != null">
        cust_city,
      </if>
      <if test="custArea != null">
        cust_area,
      </if>
      <if test="isCallback != null">
        is_callback,
      </if>
      <if test="remark != null">
        remark,
      </if>
      <if test="returnChangeRemark != null">
        return_change_remark,
      </if>
      <if test="isDel != null">
        is_del,
      </if>
      <if test="allotTime != null">
        allot_time,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="createTimeLong != null">
        create_time_long,
      </if>
      <if test="updateTime != null">
        update_time,
      </if>
      <if test="ownerType != null">
        owner_type,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=BIGINT},
      </if>
      <if test="clueId != null">
        #{clueId,jdbcType=BIGINT},
      </if>
      <if test="clueNumber != null">
        #{clueNumber,jdbcType=VARCHAR},
      </if>
      <if test="numCode != null">
        #{numCode,jdbcType=TINYINT},
      </if>
      <if test="clueSource != null">
        #{clueSource,jdbcType=TINYINT},
      </if>
      <if test="clueKnow != null">
        #{clueKnow,jdbcType=TINYINT},
      </if>
      <if test="clueConsult != null">
        #{clueConsult,jdbcType=TINYINT},
      </if>
      <if test="clueType != null">
        #{clueType,jdbcType=TINYINT},
      </if>
      <if test="clueStatusOnline != null">
        #{clueStatusOnline,jdbcType=TINYINT},
      </if>
      <if test="clueKeyword != null">
        #{clueKeyword,jdbcType=VARCHAR},
      </if>
      <if test="adminId != null">
        #{adminId,jdbcType=BIGINT},
      </if>
      <if test="adminName != null">
        #{adminName,jdbcType=VARCHAR},
      </if>
      <if test="owner != null">
        #{owner,jdbcType=BIGINT},
      </if>
      <if test="ownerName != null">
        #{ownerName,jdbcType=VARCHAR},
      </if>
      <if test="custName != null">
        #{custName,jdbcType=VARCHAR},
      </if>
      <if test="custAddr != null">
        #{custAddr,jdbcType=VARCHAR},
      </if>
      <if test="custProvince != null">
        #{custProvince,jdbcType=INTEGER},
      </if>
      <if test="custCity != null">
        #{custCity,jdbcType=INTEGER},
      </if>
      <if test="custArea != null">
        #{custArea,jdbcType=INTEGER},
      </if>
      <if test="isCallback != null">
        #{isCallback,jdbcType=BIT},
      </if>
      <if test="remark != null">
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="returnChangeRemark != null">
        #{returnChangeRemark,jdbcType=VARCHAR},
      </if>
      <if test="isDel != null">
        #{isDel,jdbcType=BIT},
      </if>
      <if test="allotTime != null">
        #{allotTime,jdbcType=TIMESTAMP},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="createTimeLong != null">
        #{createTimeLong,jdbcType=INTEGER},
      </if>
      <if test="updateTime != null">
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="ownerType != null">
        #{ownerType,jdbcType=TINYINT},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.vcooline.crm.common.model.CrmClue">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 22 10:16:27 CST 2015.
    -->
    update crm_clue
    <set>
      <if test="clueId != null">
        clue_id = #{clueId,jdbcType=BIGINT},
      </if>
      <if test="clueNumber != null">
        clue_number = #{clueNumber,jdbcType=VARCHAR},
      </if>
      <if test="numCode != null">
        num_code = #{numCode,jdbcType=TINYINT},
      </if>
      <if test="clueSource != null">
        clue_source = #{clueSource,jdbcType=TINYINT},
      </if>
      <if test="clueKnow != null">
        clue_know = #{clueKnow,jdbcType=TINYINT},
      </if>
      <if test="clueConsult != null">
        clue_consult = #{clueConsult,jdbcType=TINYINT},
      </if>
      <if test="clueType != null">
        clue_type = #{clueType,jdbcType=TINYINT},
      </if>
      <if test="clueStatusOnline != null">
        clue_status_online = #{clueStatusOnline,jdbcType=TINYINT},
      </if>
      <if test="clueKeyword != null">
        clue_keyword = #{clueKeyword,jdbcType=VARCHAR},
      </if>
      <if test="adminId != null">
        admin_id = #{adminId,jdbcType=BIGINT},
      </if>
      <if test="adminName != null">
        admin_name = #{adminName,jdbcType=VARCHAR},
      </if>
      <if test="owner != null">
        owner = #{owner,jdbcType=BIGINT},
      </if>
      <if test="ownerName != null">
        owner_name = #{ownerName,jdbcType=VARCHAR},
      </if>
      <if test="custName != null">
        cust_name = #{custName,jdbcType=VARCHAR},
      </if>
      <if test="custAddr != null">
        cust_addr = #{custAddr,jdbcType=VARCHAR},
      </if>
      <if test="custProvince != null">
        cust_province = #{custProvince,jdbcType=INTEGER},
      </if>
      <if test="custCity != null">
        cust_city = #{custCity,jdbcType=INTEGER},
      </if>
      <if test="custArea != null">
        cust_area = #{custArea,jdbcType=INTEGER},
      </if>
      <if test="isCallback != null">
        is_callback = #{isCallback,jdbcType=BIT},
      </if>
      <if test="remark != null">
        remark = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="returnChangeRemark != null">
        return_change_remark = #{returnChangeRemark,jdbcType=VARCHAR},
      </if>
      <if test="isDel != null">
        is_del = #{isDel,jdbcType=BIT},
      </if>
      <if test="allotTime != null">
        allot_time = #{allotTime,jdbcType=TIMESTAMP},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="createTimeLong != null">
        create_time_long = #{createTimeLong,jdbcType=BIGINT},
      </if>
      <if test="updateTime != null">
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="ownerType != null">
        owner_type = #{ownerType,jdbcType=TINYINT},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.vcooline.crm.common.model.CrmClue">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 22 10:16:27 CST 2015.
    -->
    update crm_clue
    set clue_id = #{clueId,jdbcType=VARCHAR},
      clue_number = #{clueNumber,jdbcType=VARCHAR},
      num_code = #{numCode,jdbcType=TINYINT},
      clue_source = #{clueSource,jdbcType=TINYINT},
      clue_know = #{clueKnow,jdbcType=TINYINT},
      clue_consult = #{clueConsult,jdbcType=TINYINT},
      clue_type = #{clueType,jdbcType=TINYINT},
      clue_status_online = #{clueStatusOnline,jdbcType=TINYINT},
      clue_keyword = #{clueKeyword,jdbcType=VARCHAR},
      admin_id = #{adminId,jdbcType=BIGINT},
      admin_name = #{adminName,jdbcType=VARCHAR},
      owner = #{owner,jdbcType=BIGINT},
      owner_name = #{ownerName,jdbcType=VARCHAR},
      cust_name = #{custName,jdbcType=VARCHAR},
      cust_addr = #{custAddr,jdbcType=VARCHAR},
      cust_province = #{custProvince,jdbcType=INTEGER},
      cust_city = #{custCity,jdbcType=INTEGER},
      cust_area = #{custArea,jdbcType=INTEGER},
      is_callback = #{isCallback,jdbcType=BIT},
      remark = #{remark,jdbcType=VARCHAR},
      return_change_remark = #{returnChangeRemark,jdbcType=VARCHAR},
      is_del = #{isDel,jdbcType=BIT},
      allot_time = #{allotTime,jdbcType=TIMESTAMP},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      create_time_long = #{createTimeLong,jdbcType=BIGINT},
      update_time = #{updateTime,jdbcType=TIMESTAMP},
      owner_type = #{ownerType,jdbcType=TINYINT}
    where id = #{id,jdbcType=BIGINT}
  </update>
  <!--基本查询Map-->
  <resultMap extends="BaseResultMap" id="BaseQueryMap" type="com.vcooline.crm.common.model.CrmClue">
    <result column="contacts" jdbcType="VARCHAR" property="contacts" />
    <result column="provinceName" jdbcType="VARCHAR" property="provinceName" />
    <result column="provinceName" jdbcType="VARCHAR" property="provinceName" />
    <result column="callTime" jdbcType="TIMESTAMP" property="callTime" />
  </resultMap>

  <!--获取最大自增码-->
  <select id="getMaxNumCode" resultType="java.lang.Integer">
    SELECT
    max(cc.num_code)
    FROM
    crm_clue cc FORCE INDEX (inx_crm_clue_create_time_long)
    WHERE
    cc.create_time_long &gt;= UNIX_TIMESTAMP(
    DATE_FORMAT(NOW(), '%Y-01-01 00:00:00')
    )
    AND cc.create_time_long &lt;= UNIX_TIMESTAMP(
    DATE_FORMAT(NOW(), '%Y-12-31 23:59:59')
    )
    ORDER BY
    cc.num_code DESC
  </select>

  <!--分页查询-->
  <select id="queryCrmClueForPage" resultMap="BaseQueryMap">


    SELECT
    <include refid="Base_Column_List" />
    , (
    SELECT
    p.name
    FROM
    provinces p
    WHERE
    p.id = cc.cust_province
    ) AS provinceName,
    (
    SELECT
    c.name
    FROM
    cities c
    WHERE
    c.id = cc.cust_city
    ) AS cityName,
    (
    SELECT
    cust.cust_name
    FROM
    crm_customer cust,
    crm_rele_cust ccc
    WHERE
    cust.id = ccc.cust_id
    AND ccc.target_id = cc.id
    AND ccc.rele_type = 1
    <if test="page.params.contacts != null">
      AND cust.cust_name LIKE '%${page.params.contacts}%'
    </if>
    <if test="page.params.contactsPhone != null">
      AND cust.cust_phone LIKE '%${page.params.contactsPhone}%'
    </if>
    <if test="page.params.contactsQQ != null and page.params.contactsQQ != ''">
      AND cust.cust_qq LIKE '%${page.params.contactsQQ}%'
    </if>
    LIMIT 0,
    1
    ) AS contacts,
    (SELECT
    count(ccall.id)
    FROM
    crm_callback ccall
    WHERE
    ccall.rele_type = 1
    AND ccall.target_id = cc.id) as optionStatus,
    (SELECT
    ccb.call_bargain
    FROM
    crm_callback ccb
    WHERE
    ccb.target_id = cc.id
    AND ccb.rele_type = 1
    AND ccb.is_del = 0
    ORDER BY ccb.create_time DESC limit 0,1 ) AS callBargain,
    (SELECT
      ccb.call_time
      FROM
      crm_callback ccb
      WHERE
      ccb.target_id = cc.id
      AND ccb.rele_type = 1
      AND ccb.is_del = 0
      ORDER BY ccb.call_time DESC limit 0,1 ) AS callTime,
    (SELECT
    ccb.call_next_time
    FROM
    crm_callback ccb
    WHERE
    ccb.target_id = cc.id
    AND ccb.rele_type = 1
    AND ccb.is_del = 0
    ORDER BY ccb.call_time DESC limit 0,1 ) AS callNextTime,
    (
    SELECT
    count(DISTINCT(ccc.id))
    FROM
    crm_customer ccc,
    crm_rele_cust crcc,
    crm_customer ccc2,
    crm_rele_cust crcc2
    WHERE
    ccc2.id = crcc2.cust_id
    AND crcc2.rele_type = 1
    AND crcc2.target_id = cc.id
    AND ccc.id = crcc.cust_id
    AND crcc.rele_type = 1
    AND ccc.cust_phone = ccc2.cust_phone
    AND crcc.target_id != cc.id
    ) AS isRepeat
    FROM
    crm_clue cc
    WHERE 1=1
    <if test="page.params.custName != null">
      AND cc.cust_name LIKE '%${page.params.custName}%'
    </if>
    <if test="page.params.clueStatusOnline != null">
      AND cc.clue_status_online = #{page.params.clueStatusOnline,jdbcType=TINYINT}
    </if>
    <if test="page.params.custProvince != null">
      AND cc.cust_province = #{page.params.custProvince,jdbcType=INTEGER}
    </if>
    <if test="page.params.custCity != null">
      AND cc.cust_city = #{page.params.custCity,jdbcType=INTEGER}
    </if>
    <if test="page.params.clueType != null">
      AND cc.clue_type = #{page.params.clueType,jdbcType=TINYINT}
    </if>
    <if test="page.params.clueSource != null">
      AND cc.clue_source = #{page.params.clueSource,jdbcType=TINYINT}
    </if>
    <if test="page.params.clueKnow != null">
      AND cc.clue_know = #{page.params.clueKnow,jdbcType=TINYINT}
    </if>
    <if test="page.params.ownerName != null">
      AND cc.owner_name LIKE '%${page.params.ownerName}%'
    </if>
    <if test="page.params.contacts != null || page.params.contactsPhone != null">
      AND  EXISTS (
      SELECT
      cust.cust_name
      FROM
      crm_customer cust,
      crm_rele_cust ccc
      WHERE
      cust.id = ccc.cust_id
      AND ccc.target_id = cc.id
      AND ccc.rele_type = 1
      <if test="page.params.contacts != null">
        AND cust.cust_name LIKE  '%${page.params.contacts}%'
      </if>
      <if test="page.params.contactsPhone != null">
        AND cust.cust_phone LIKE '%${page.params.contactsPhone}%'
      </if>

      LIMIT 0,
      1
      )
    </if>
    <if test="page.params.productId != null">
      AND EXISTS (
      SELECT
      cp.id
      FROM
      crm_product cp,
      crm_clue_product ccp
      WHERE
      cp.id = ccp.product_id
      AND ccp.clue_id = cc.id
      AND cp.id =  #{page.params.productId,jdbcType=BIGINT}
      AND ccp.is_del = 0
      )
    </if>

    <if test="page.params.createTimestart != null">
        AND cc.create_time &gt;= #{page.params.createTimestart,jdbcType=TIMESTAMP}
    </if>
    <if test="page.params.createTimeend != null">
      AND cc.create_time &lt;= #{page.params.createTimeend,jdbcType=TIMESTAMP}
    </if>
    <if test="page.params.allotTimestart != null">
        AND cc.allot_time &gt;= #{page.params.allotTimestart,jdbcType=TIMESTAMP}
    </if>
    <if test="page.params.allotTimeend != null">
      AND cc.allot_time &lt;= #{page.params.allotTimeend,jdbcType=TIMESTAMP}
    </if>
    <!--线索查询只能查询owner是自己的-->
    <if test="page.params.searchType == 0">
      AND cc.clue_status_online != 0
      <if test="page.params.isDepManager == 0"><!--非部门管理者-->
        <if test="page.params.owner != null">
          AND cc.owner = #{page.params.owner,jdbcType=BIGINT}
        </if>
        <if test="page.params.owner == null">
          AND cc.owner = #{page.params.userId,jdbcType=BIGINT}
        </if>
        <if test="page.params.adminId != null">
          AND cc.admin_id = #{page.params.adminId,jdbcType=BIGINT}
        </if>
      </if>
      <if test="page.params.isDepManager == 1"><!--是部门管理者-->
        <if test="page.params.owner == null">
          AND cc.owner IN
            <foreach collection="page.params.ownersList" item="ow" index="index" open="(" close=")" separator=",">
              #{ow}
            </foreach>

        </if>
        <if test="page.params.owner != null">
          AND cc.owner = #{page.params.owner,jdbcType=BIGINT}
        </if>
      </if>
      <if test="page.params.roleType == 0 and page.params.owner != null">
        AND cc.owner = #{page.params.owner,jdbcType=BIGINT}
      </if>
    </if>
    <!--呼叫中心查询，只能查询当前用户为录入人的数据-->
    <if test="page.params.searchType == 1">

      <if test="page.params.isDepManager == 0"><!--非部门管理者-->
        <if test="page.params.adminId != null">
          AND cc.admin_id = #{page.params.adminId,jdbcType=BIGINT}
        </if>
        <if test="page.params.owner != null">
          AND cc.owner = #{page.params.owner,jdbcType=BIGINT}
        </if>
      </if>
      <if test="page.params.isDepManager == 1"><!--是部门管理者-->
        AND cc.admin_id IN <foreach collection="page.params.ownersList" item="ow" index="index" open="(" close=")" separator=",">
          #{ow}
        </foreach>
      </if>
    </if>


    AND cc.is_del = 0
    <if test="page.params.optionStatus != null || page.params.callBargain != null || page.params.nextTimestart != null || page.params.nextTimeend != null || page.params.callTimestart != null || page.params.callTimeend != null || page.params.contactsQQ != null">
      HAVING (
      1=1
      <if test="page.params.optionStatus == 0">
        AND  `optionStatus`=#{page.params.optionStatus,jdbcType=TINYINT}
      </if>
      <if test="page.params.optionStatus > 0">
        AND `optionStatus`&gt;=#{page.params.optionStatus,jdbcType=TINYINT}
      </if>
      <if test="page.params.callBargain != null">
        AND `callBargain`=#{page.params.callBargain,jdbcType=TINYINT}
      </if>
      <if test="page.params.nextTimestart != null">
       AND `callNextTime`&gt;=#{page.params.nextTimestart,jdbcType=TIMESTAMP}
      </if>
      <if test="page.params.nextTimeend">
        AND `callNextTime`&lt;=#{page.params.nextTimeend,jdbcType=TIMESTAMP}
      </if>
      <if test="page.params.callTimestart != null">
        AND `callTime`&gt;=#{page.params.callTimestart,jdbcType=TIMESTAMP}
      </if>
      <if test="page.params.callTimeend != null">
        AND `callTime`&lt;=#{page.params.callTimeend,jdbcType=TIMESTAMP}
      </if>
      <if test="page.params.contactsQQ != null and page.params.contactsQQ != ''">
        AND contacts IS NOT NULL
      </if>
      )
    </if>

    ORDER BY cc.create_time DESC

  </select>


  <select id="queryCrmClueByPhone" parameterType="java.lang.String" resultMap="BaseResultMap">
    SELECT
	cc.*
FROM
	crm_clue cc,
	crm_rele_cust ccc,
	crm_customer cct
WHERE
	cc.id = ccc.target_id
AND ccc.rele_type = 1
AND ccc.cust_id = cct.id
AND cct.cust_phone = #{phone,jdbcType=VARCHAR}
  </select>


  <select id="queryCrmClueByCustName" parameterType="java.lang.String" resultMap="BaseResultMap">
    SELECT
    cc.*
    FROM
    crm_clue cc
    WHERE
    cc.cust_name = #{custName,jdbcType=VARCHAR}
    AND cc.is_del = 0
  </select>

  <select id="selectByClueId" parameterType="java.lang.Long" resultMap="BaseResultMap">
    SELECT
    cc.*
    FROM
    crm_clue cc
    WHERE
    cc.clue_id = #{clueId,jdbcType=BIGINT}
  </select>
</mapper>