<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.vcooline.crm.common.mapper.CrmRoleMapper">
    <resultMap id="BaseResultMap" type="com.vcooline.crm.common.model.CrmRole">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Jul 16 15:20:22 CST 2015.
        -->
        <id column="id" jdbcType="BIGINT" property="id"/>
        <result column="role_code" jdbcType="INTEGER" property="roleCode"/>
        <result column="role_name" jdbcType="VARCHAR" property="roleName"/>
        <result column="role_desc" jdbcType="VARCHAR" property="roleDesc"/>
        <result column="role_type" jdbcType="TINYINT" property="roleType"/>
        <result column="is_del" jdbcType="BIT" property="isDel"/>
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime"/>
        <result column="update_time" jdbcType="TIMESTAMP" property="updateTime"/>
    </resultMap>

    <!-- 角色权限信息 一对多 -->
    <resultMap id="resultMap" type="com.vcooline.crm.common.model.CrmRole">
        <id column="id" jdbcType="BIGINT" property="id"/>
        <result column="role_code" jdbcType="INTEGER" property="roleCode"/>
        <result column="role_name" jdbcType="VARCHAR" property="roleName"/>
        <result column="role_desc" jdbcType="VARCHAR" property="roleDesc"/>
        <result column="role_type" jdbcType="TINYINT" property="roleType"/>
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime"/>
        <collection property="authRoleList" ofType="com.vcooline.crm.common.model.CrmRoleAuth">
            <result column="auth_id" jdbcType="BIGINT" property="authId"/>
            <result column="auth_name" jdbcType="VARCHAR" property="authName"/>
        </collection>
    </resultMap>

    <!-- <resultMap type="com.vcooline.crm.common.model.CrmRoleAuth" id="roleAuthResultMap">
       <result column="role_id" jdbcType="BIGINT" property="roleId" />
       <result column="auth_id" jdbcType="BIGINT" property="authId" />
       <association property="authList" javaType="com.vcooline.crm.common.model.CrmAuth">
             <id column="id" jdbcType="BIGINT" property="authId" />
              <result column="auth_code" jdbcType="INTEGER" property="authCode" />
              <result column="parent_id" jdbcType="BIGINT" property="parentId" />
              <result column="auth_name" jdbcType="VARCHAR" property="authName" />
              <result column="auth_type" jdbcType="TINYINT" property="authType" />
              <result column="auth_desc" jdbcType="VARCHAR" property="authDesc" />
              <result column="auth_url" jdbcType="VARCHAR" property="authUrl" />
              <result column="auth_sort" jdbcType="INTEGER" property="authSort" />
       </association>
    </resultMap> -->
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Jul 16 15:20:22 CST 2015.
        -->
        id, role_code, role_name, role_desc, role_type, is_del, create_time, update_time
    </sql>
    <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Jul 16 15:20:22 CST 2015.
        -->
        select
        <include refid="Base_Column_List"/>
        from crm_role
        where id = #{id,jdbcType=BIGINT}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Jul 16 15:20:22 CST 2015.
        -->
        delete from crm_role
        where id = #{id,jdbcType=BIGINT}
    </delete>
    <insert id="insert" parameterType="com.vcooline.crm.common.model.CrmRole">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Jul 16 15:20:22 CST 2015.
        -->
        insert into crm_role (id, role_code, role_name,
        role_desc, role_type, is_del,
        create_time, update_time)
        values (#{id,jdbcType=BIGINT}, #{roleCode,jdbcType=INTEGER}, #{roleName,jdbcType=VARCHAR},
        #{roleDesc,jdbcType=VARCHAR}, #{roleType,jdbcType=TINYINT}, #{isDel,jdbcType=BIT},
        #{createTime,jdbcType=TIMESTAMP}, #{updateTime,jdbcType=TIMESTAMP})
    </insert>
    <insert id="insertSelective" parameterType="com.vcooline.crm.common.model.CrmRole" useGeneratedKeys="true"
            keyProperty="id">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Jul 16 15:20:22 CST 2015.
        -->
        insert into crm_role
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="roleCode != null">
                role_code,
            </if>
            <if test="roleName != null">
                role_name,
            </if>
            <if test="roleDesc != null">
                role_desc,
            </if>
            <if test="roleType != null">
                role_type,
            </if>
            <if test="isDel != null">
                is_del,
            </if>
            <if test="createTime != null">
                create_time,
            </if>
            <if test="updateTime != null">
                update_time,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=BIGINT},
            </if>
            <if test="roleCode != null">
                #{roleCode,jdbcType=INTEGER},
            </if>
            <if test="roleName != null">
                #{roleName,jdbcType=VARCHAR},
            </if>
            <if test="roleDesc != null">
                #{roleDesc,jdbcType=VARCHAR},
            </if>
            <if test="roleType != null">
                #{roleType,jdbcType=TINYINT},
            </if>
            <if test="isDel != null">
                #{isDel,jdbcType=BIT},
            </if>
            <if test="createTime != null">
                #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updateTime != null">
                #{updateTime,jdbcType=TIMESTAMP},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.vcooline.crm.common.model.CrmRole">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Jul 16 15:20:22 CST 2015.
        -->
        update crm_role
        <set>
            <if test="roleCode != null">
                role_code = #{roleCode,jdbcType=INTEGER},
            </if>
            <if test="roleName != null">
                role_name = #{roleName,jdbcType=VARCHAR},
            </if>
            <if test="roleDesc != null">
                role_desc = #{roleDesc,jdbcType=VARCHAR},
            </if>
            <if test="roleType != null">
                role_type = #{roleType,jdbcType=TINYINT},
            </if>
            <if test="isDel != null">
                is_del = #{isDel,jdbcType=BIT},
            </if>
            <if test="createTime != null">
                create_time = #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updateTime != null">
                update_time = #{updateTime,jdbcType=TIMESTAMP},
            </if>
        </set>
        where id = #{id,jdbcType=BIGINT}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.vcooline.crm.common.model.CrmRole">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Jul 16 15:20:22 CST 2015.
        -->
        update crm_role
        set role_code = #{roleCode,jdbcType=INTEGER},
        role_name = #{roleName,jdbcType=VARCHAR},
        role_desc = #{roleDesc,jdbcType=VARCHAR},
        role_type = #{roleType,jdbcType=TINYINT},
        is_del = #{isDel,jdbcType=BIT},
        create_time = #{createTime,jdbcType=TIMESTAMP},
        update_time = #{updateTime,jdbcType=TIMESTAMP}
        where id = #{id,jdbcType=BIGINT}
    </update>

    <!-- 查询获取角色列表  曹欢 2015-07-17 -->
    <select id="getRoleList" resultMap="resultMap">
        SELECT A.*,B.auth_id,C.auth_name AS auth_name FROM crm_role A INNER JOIN crm_role_auth B ON A.ID = B.role_id
        INNER JOIN crm_auth C ON C.id = B.auth_id

        WHERE A.is_del = 0 AND A.role_type != 0 AND B.is_del = 0
    </select>

    <select id="getRoleById" resultMap="resultMap" parameterType="java.lang.Long">
        SELECT A.ID,A.role_name,A.role_desc,C.ID AS AUTH_ID,C.auth_code,C.auth_name,C.auth_desc,C.parent_id FROM
        crm_role A
        INNER JOIN crm_role_auth B on A.id = B.role_id
        INNER JOIN crm_auth C on B.auth_id = C.id WHERE A.id = #{id}
        AND A.is_del = 0 AND B.is_del=0 AND C.is_del = 0
        ORDER BY C.auth_sort
    </select>

    <!-- 软删角色 -->
    <update id="deleteRoleById" parameterType="java.lang.Long">
        update crm_role set is_del = 1 where id= #{id}
    </update>
</mapper>