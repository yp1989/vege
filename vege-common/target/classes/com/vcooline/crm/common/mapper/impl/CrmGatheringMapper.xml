<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.vcooline.crm.common.mapper.CrmGatheringMapper">
  <resultMap id="BaseResultMap" type="com.vcooline.crm.common.model.CrmGathering">
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="cont_id" jdbcType="BIGINT" property="contId" />
    <result column="gath_money" jdbcType="DECIMAL" property="gathMoney" />
    <result column="gath_date" jdbcType="TIMESTAMP" property="gathDate" />
    <result column="register_id" jdbcType="BIGINT" property="registerId" />
    <result column="register_name" jdbcType="VARCHAR" property="registerName" />
    <result column="is_del" jdbcType="BIT" property="isDel" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
  </resultMap>

  <resultMap id="BaseResultMapPage" type="com.vcooline.crm.common.model.CrmGathering" extends="BaseResultMap">
    <result column="custName" jdbcType="VARCHAR" property="custName" />
    <result column="owerName" jdbcType="VARCHAR" property="owerName" />
    <result column="contNumber" jdbcType="VARCHAR" property="contNumber" />
    <result column="contType" jdbcType="BIT" property="contType" />
      <result column="clueId" jdbcType="BIGINT" property="clueId" />
  </resultMap>
  <sql id="Base_Column_List">
    id, cont_id, gath_money, gath_date, register_id, register_name, is_del, create_time,
    update_time
  </sql>
    <sql id="Base_Column_List_Alise">
        cg.id, cg.cont_id, cg.gath_money, cg.gath_date, cg.register_id, cg.register_name, cg.is_del, cg.create_time, cg.update_time
    </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 05 14:41:06 CST 2015.
    -->
    select 
    <include refid="Base_Column_List" />
    from crm_gathering
    where id = #{id,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 05 14:41:06 CST 2015.
    -->
    delete from crm_gathering
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.vcooline.crm.common.model.CrmGathering">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 05 14:41:06 CST 2015.
    -->
    insert into crm_gathering (id, cont_id, gath_money, 
      gath_date, register_id, register_name, 
      is_del, create_time, update_time
      )
    values (#{id,jdbcType=BIGINT}, #{contId,jdbcType=BIGINT}, #{gathMoney,jdbcType=DECIMAL}, 
      #{gathDate,jdbcType=TIMESTAMP}, #{registerId,jdbcType=BIGINT}, #{registerName,jdbcType=VARCHAR}, 
      #{isDel,jdbcType=BIT}, #{createTime,jdbcType=TIMESTAMP}, #{updateTime,jdbcType=TIMESTAMP}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.vcooline.crm.common.model.CrmGathering">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 05 14:41:06 CST 2015.
    -->
    insert into crm_gathering
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="contId != null">
        cont_id,
      </if>
      <if test="gathMoney != null">
        gath_money,
      </if>
      <if test="gathDate != null">
        gath_date,
      </if>
      <if test="registerId != null">
        register_id,
      </if>
      <if test="registerName != null">
        register_name,
      </if>
      <if test="isDel != null">
        is_del,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="updateTime != null">
        update_time,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=BIGINT},
      </if>
      <if test="contId != null">
        #{contId,jdbcType=BIGINT},
      </if>
      <if test="gathMoney != null">
        #{gathMoney,jdbcType=DECIMAL},
      </if>
      <if test="gathDate != null">
        #{gathDate,jdbcType=TIMESTAMP},
      </if>
      <if test="registerId != null">
        #{registerId,jdbcType=BIGINT},
      </if>
      <if test="registerName != null">
        #{registerName,jdbcType=VARCHAR},
      </if>
      <if test="isDel != null">
        #{isDel,jdbcType=BIT},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null">
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.vcooline.crm.common.model.CrmGathering">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 05 14:41:06 CST 2015.
    -->
    update crm_gathering
    <set>
      <if test="contId != null">
        cont_id = #{contId,jdbcType=BIGINT},
      </if>
      <if test="gathMoney != null">
        gath_money = #{gathMoney,jdbcType=DECIMAL},
      </if>
      <if test="gathDate != null">
        gath_date = #{gathDate,jdbcType=TIMESTAMP},
      </if>
      <if test="registerId != null">
        register_id = #{registerId,jdbcType=BIGINT},
      </if>
      <if test="registerName != null">
        register_name = #{registerName,jdbcType=VARCHAR},
      </if>
      <if test="isDel != null">
        is_del = #{isDel,jdbcType=BIT},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null">
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.vcooline.crm.common.model.CrmGathering">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Aug 05 14:41:06 CST 2015.
    -->
    update crm_gathering
    set cont_id = #{contId,jdbcType=BIGINT},
      gath_money = #{gathMoney,jdbcType=DECIMAL},
      gath_date = #{gathDate,jdbcType=TIMESTAMP},
      register_id = #{registerId,jdbcType=BIGINT},
      register_name = #{registerName,jdbcType=VARCHAR},
      is_del = #{isDel,jdbcType=BIT},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      update_time = #{updateTime,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=BIGINT}
  </update>

  <!--查询分页-->
  <select id="queryGatherForPage" parameterType="com.vcooline.crm.common.model.Page" resultMap="BaseResultMapPage">
SELECT
      <include refid="Base_Column_List_Alise" />,
	 ct.cont_number contNumber,
	ct.cont_type contType,
    ct.acc_status accStatus,
	ccl.cust_name custName,
	ccl.id AS clueId,
	cb.owner_name owerName
FROM
	crm_gathering cg,
	crm_contract ct,
	crm_business cb,
	crm_clue ccl
WHERE
	cg.cont_id = ct.id
AND ct.busi_id = cb.id
AND cb.clue_id = ccl.id
      <if test="page.params.custName != null">
          AND ccl.cust_name LIKE '%${page.params.custName}%'
      </if>
      <if test="page.params.contNumber != null">
          AND ct.cont_number LIKE '%${page.params.contNumber}%'
      </if>
      <if test="page.params.clueId != null">
          AND ccl.id = #{page.params.clueId,jdbcType=BIGINT}
      </if>
      <if test="page.params.owerName != null">
          AND cb.owner = #{page.params.owner,jdbcType=BIGINT}
      </if>
      <if test="page.params.gathTimestart != null">
          AND cg.gath_date &gt;= #{page.params.gathTimestart,jdbcType=TIMESTAMP}
      </if>
      <if test="page.params.gathTimeend != null">
          AND cg.gath_date &lt;= #{page.params.gathTimeend,jdbcType=TIMESTAMP}
      </if>
ORDER  BY cg.create_time DESC
  </select>
</mapper>